{% extends request.args.get('layout', 'layout.html') %}

{% block content %}
<div class="h-full w-full flex flex-col relative" x-data="quizApp('{{ mode }}', '{{ book }}')" x-init="init()">

    <div class="absolute top-4 w-full z-[100] flex items-center justify-between px-6 pointer-events-none">
        <a href="/" hx-target="#main-content" hx-swap="innerHTML" hx-push-url="true"
           class="pointer-events-auto flex items-center gap-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md px-4 py-2 rounded-full border border-white/20 shadow-sm font-bold text-sm hover:scale-105 transition-transform">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            <span x-text="t('exit')">Exit</span>
        </a>
        
        <div class="pointer-events-auto px-5 py-2 rounded-full bg-white/80 dark:bg-slate-800/80 border border-white/20 backdrop-blur-md shadow-sm text-xs font-bold flex items-center gap-2 overflow-hidden max-w-md" 
             x-show="mode === 'mistake'">
             <template x-for="(crumb, idx) in bookData.breadcrumbs" :key="crumb.id">
                <div class="flex items-center gap-2">
                    <span @click="loadBook(crumb.id)" 
                          class="cursor-pointer hover:text-blue-500 transition-colors"
                          :class="idx === bookData.breadcrumbs.length - 1 ? 'opacity-100 underline decoration-blue-500' : 'opacity-50'"
                          x-text="crumb.name"></span>
                    <span x-show="idx < bookData.breadcrumbs.length - 1" class="opacity-30">/</span>
                </div>
             </template>
        </div>

        <div x-show="mode !== 'mistake'" class="pointer-events-auto px-5 py-2 rounded-full bg-white/80 dark:bg-slate-800/80 border border-white/20 backdrop-blur-md shadow-sm text-xs font-black uppercase tracking-widest opacity-70">
            <span x-text="mode + ' Mode'"></span>
        </div>

        <button @click="toggleAI()" class="pointer-events-auto px-4 py-2 rounded-full border border-white/20 transition-all duration-300 backdrop-blur-md shadow-sm flex items-center gap-2 group font-bold" 
                :class="aiOpen ? 'bg-blue-500 text-white border-blue-500' : 'bg-white/80 dark:bg-slate-800/80 hover:bg-white dark:hover:bg-slate-700'">
            <span x-text="t('ai_assist')">AI Assist</span>
            <div class="w-2 h-2 rounded-full" :class="aiOpen ? 'bg-white animate-pulse' : 'bg-green-500'"></div>
        </button>
    </div>

    <div class="flex-1 flex overflow-hidden relative h-full pt-16">
        
        {% include 'components/quiz_sidebar_left.html' %}
        
        {% include 'components/quiz_content.html' %}

        {% include 'components/quiz_sidebar_right.html' %}

    </div>

    {% include 'components/quiz_modals.html' %}

</div>
{% endblock %}